## 付録C：コマンド一覧  *-- SAMPLE --*

本付録では、本書で取り上げたjqコマンドオプション（付録C.1）、`.`などフィルタで用いる特殊記号（付録C.2）、演算子（付録C.3）、一般的な関数（付録C.4）、数学関数（付録C.5）、定数（付録C.6）をまとめて表に示します。項目はアルファベット順（記号はASCIIコード順）に並べています。

本書は、[jqマニュアル v1.6](https://stedolan.github.io/jq/manual/v1.6/ "LINKS")記載の機能のうち一部はカバーしていません。以下の表で未記述のものは、マニュアルを参照してください。

付録C.4と付録C.5の「引数の数」列で0とは、それら関数は引数を取らず、入力はパイプからのみ受けつけるという意味です。範囲で示したときは、引数の数が機能に応じて可変です。たとえば、`range`関数（5.5節）は`range(10)`、`range(10;20)`、`range(10;20;2)`のように3通りの使いかたがあるので、1～3と示しています。関数引数がふたつ以上のときは、`f(a; b)`のようにセミコロン（`;`）で区切ります。

### C.1 コマンドオプション

本節にはコマンドオプションをまとめて示します。ハイフンとアルファベット1文字からなるショートカットがあるものは2列目に記載しました。

表C.1 コマンドオプション

コマンドオプション | ショートカット | 機能 | 参照
-------------|-----------|-----|--------
`--arg <var> <value>` | | 変数`<var>`に値`<value>`を定義する（値は文字列になる） | 10.3節
`--argjson <name> <value>` | | 変数`<var>`に値`<value>`を定義する（値は表記から推定される型になる）| 10.3節
`--ascii-output` | `-a` | 非ASCII文字を"\uXXXX"形式で表示する | 1.3節
`--color-output` | `-C` | パイプ後も配色を維持する | 1.3節
`--compact-output` | `-c` | 出力をコンパクトにまとめる | 1.3節
`--exit-status` | `-e` | 終了コードを変更する | 1.3節
`--from-file <file>` | `-f <file>` | フィルタを記述したファイル`<file>`を読み込む | 2.2節 
`--indent <n>` || インデント幅を`<n>`に変更する（デフォルトは2文字）| 1.3節
`--join-output` | `-j` | 出力から末尾の改行を除く | 1.3節
`--monochrome-output` | `-M` | 出力をモノクロにする | 1.3節
`--null-input` | `-n` | 入力を無視する | 2.1節
`--raw-input` | `-R` | 入力を文字列として解釈する | 2.1節 
`--raw-output` | `-r` | 文字列のダブルクォートを外す | 1.3節
`--rawfile <var> <file>` | | 変数`<var>`に`<file>`の中身を代入する | 10.3節
`--seq` | | JSONテキストシーケンスを利用する | 2.1節
`--slurp` | `-s` | 複数のJSONテキストを配列にまとめる | 2.1節
`--slurpfile <var> <file>`| | 変数`<var>`に`<file>`の中身を代入し、配列にまとめる | 10.3節
`--sort-keys` | `-S` | プロパティ名をベースにソートする | 1.3節
`--tab` || インデントをタブに変更する（デフォルトはスペース2文字）| 1.3節
`--version` || jqのバージョン番号を出力して終了する | 1.3節


### C.2 特殊記号

本節にはフィルタを記述する特殊記号をまとめて示します。

表C.2 特殊記号

記号 | 機能 | 参照
-----|------|-----
`"` | 文字列のクォート | 1.2節
`()` | 1) 処理の優先順位指定、2）評価値の参照 | 3.5節、4.1節
`,` | 並列処理 | 3.2節
`.` | その時点のトップレベルを参照（アイデンティティ） | 1.2節
`..` | 再帰処理 | 3.6節
`;` | 1）関数引数のセパレータ、2）`def`文の終端 | 4.1節、10.4節
`?` | エラーを無視 | 3.4節、10.2節
`[]` | 1) 配列要素指定（`[n]`）、2) 配列および文字列スライス（`[n:m]`）、3) プロパティ指定（`["property"]`）、4）イテレータ（`[]`）、5）配列化(`[...]`) | 1.2節、3.1節
`{}` | オブジェクト生成 | 3.5節
<code>&#124;</code>| パイプ（連続フィルタリング処理） | 3.3節

### C.3 演算子

本節には算術演算子などの演算子をまとめて示します。

表C.3 演算子

演算子 | タイプ | 機能 | 参照
------|------|------|------
`!=` | 比較演算 | 等しくない | 9.1節
`%` | 算術演算 | モジュロ演算 | 5.1節
`%=` | 算術演算 | 更新代入（モジュロ演算）| 4.5節
`*` | 算術演算 | 1）算術乗算、2）文字列の繰り返し | 5.1節、6.1節
`*=` | 算術演算 | 更新代入（乗算）| 4.5節
`+` | 算術演算 | 1）算術加算、2）文字列の連結、3）配列およびオブジェクトの結合 | 4.3節
`+=` | 算術演算 | 更新代入（加算）| 4.5節
`-` | 算術演算 | 1）算術減算、2）配列要素の削除 | 4.3節
`-=` | 算術演算 | 更新代入（減算）| 4.5節
`/` | 算術演算 | 算術除算 | 5.1節
`/=` | 算術演算 | 更新代入（除算）| 4.5節
`//` | 条件分岐 | 代替演算子 | 10.1節
`<` | 比較演算子 | 未満 | 9.1節
`<=` | 比較演算子 | 以下 | 9.1節
`=` | 算術演算 | 代入 | 4.5節
`==` | 比較演算子 | 等しい | 9.1節
`>` | 比較演算子 | より大きい | 9.1節
`>=` | 比較演算子 | 以上 | 9.1節
`and` | 論理演算子 | 論理積 | 9.2節
`not` | 論理演算子 | 否定 | 9.2節
`or` | 論理演算子 | 論理和 | 9.2節
<code>&#124;=</code> | 算術演算 | 更新代入 | 4.5節


### C.4 一般関数

本節には関数をまとめて示します。変数定義や関数定義のような関数らしからぬ記法も含んでいます。数学関数は別途付録C.5に掲載しています。ソートなどの値の大小関係の比較でデータ型が混在しているときの順序は次のとおりです。

```
null > 真偽値 > 数値 > 文字列 > 配列 > オブジェクト
```

表C.4 関数

関数 | 引数の数 | 機能 | 参照
-----|--------|------|-------
<code>... as $identifier &#124;</code> | NA | 変数`$identifier`を定義する | 10.3節
`add` | 0 | 配列要素の和を返す（`+`参照） | 4.4節
`all` | 0～1 | （述語関数）配列要素がすべて真ならば真を返す。引数が述語関数なら配列要素をそれにしたがって真偽値に置き換える。 | 9.3節
`any`| 0～1 | （述語関数）配列要素がひとつでも真ならば真を返す。引数が述語関数なら配列要素をそれにしたがって真偽値に置き換える。 | 9.3節
`arrays` | 0 | 配列だけを抽出する | 4.2節
`ascii_downcase` | 0 | 文字列を小文字にする | 6.1節
`ascii_upcase` | 0 | 文字列を大文字にする | 6.1節
`booleans` | 0 | 真偽値だけを抽出する | 4.2節
`bsearch` | 1 | `index`のバイナリサーチ版 | 7.1節
`capture` | 1 | （正規表現）キャプチャオブジェクトを返す | 6.2節
`combinations` | 0 | 配列の配列から組みあわせを生成する | 7.2節
`contains` | 1 | (述語関数）入力に引数の値が含まれていれば真を返す | 9.3節
`def name: 式;` | NA | 関数を`name`を定義する | 10.4節
`del` | 1 | 配列あるいはオブジェクトから指定の要素を削除する | 7.2節、 8.1節
`delpaths` | 1 | 指定のパス配列を削除する | 8.3節
`empty` | 0 | なにも実行しない | 10.1節
`endswith` | 1 | （述語関数）入力末尾に引数の文字列があれば真を返す | 9.3節
`env` | 0 | 環境変数オブジェクトを得る | 10.2節
`error` | 0～1 | エラーを発生させる。引数があればそのメッセージが出力される。 | 10.2節
`explode` | 0 | 文字列のUnicodeコードを配列で返す | 6.1節
`first` | 0～1 | 配列から先頭の要素を抽出する。引数には抽出対象の配列のイテレータを指定する。 | 7.1節
`flatten` | 0 | 入れ子の配列を平板化する | 7.2節
`foreach` | 3 | 配列を順に処理する。初期化式は第1引数、更新式は第2引数、抽出式は第3引数にそれぞれ指定する。 | 10.5節
`from_entries` | 0 | keyとvalueで構成されたオブジェクトからプロパティを生成する | 8.2節
`fromdateiso8601` | 0 | ISO8601形式の日付をUnixエポックに変換する | 5.6節
`fromjson` | 0 | エスケープされたJSONデータを通常のJSONテキストに変換する| 4.2節
`getpath` | 1 | パス配列から値を抽出する | 8.3節
`gmtime` | 0 | Unixエポック時間をtm構造体配列に変換する | 5.6節
`gsub` | 2 | （正規表現）`sub`のグローバルマッチ版 | 6.2節
`halt` | 0 |  強制終了（なにも出力しない） | 10.2節
`halt_error` | 0～1 | 強制終了（処理中の値を出力）。引数があればその値を終了コードに用いる。 | 10.2節
`has` | 1 | (述語関数）入力に引数のプロパティ名が含まれていれば真を返す | 9.3節
`if-then-else-end` | 該当しない | if文。`else`から`if`を続けるときは`elif`を用いる。 | 10.1節
`implode` | 0 | Unicodeコードの配列から文字列を生成する | 6.1節
`in` | 1 | (述語関数）`has`の入力と引数を入れ替えたもの | 9.3節
`index` | 1 | 左からスキャンし、第1引数と一致する最初の位置を返す | 6.1節、7.1節
`indices` | 1 | 第1引数と一致する位置をすべて配列で返す | 6.1節、7.1節
`inside` | 1 | (述語関数）`contains`の入力と引数を入れ替えたもの | 9.3節
`isfinite` | 0 | （述語関数）数値が有限ならば真を返す | 9.3節
`isinfinite` | 0 | （述語関数）数値が無限ならば真を返す | 9.3節
`isnan` | 0 | （述語関数）数値が非数ならば真を返す | 9.3節
`isnormal` | 0 | （述語関数）数値が一般的な数値ならば真を返す | 9.3節
`iterables` | 0 | イテラブル（配列とオブジェクト）を抽出する | 4.2節
`join` | 1 | 配列要素を指定のデリミタで連結する | 6.1節
`keys` | 0 | オブジェクトからプロパティ名を抽出し、配列を返す。結果はソートされる。 | 8.1節
`keys_unsorted` | 0 | `keys`の未ソート版 | 8.1節
`last` | 0～1 | 配列から末尾の要素を抽出する。引数には抽出対象の配列のイテレータを指定する。 | 7.1節
`length` | 0 | 文字数、配列要素数、あるいはプロパティの数を返す | 4.4節
`limit` | 2 | 第1引数に指定した個数分だけ、第2要素の配列から要素を抽出する | 7.1節
`localtime` | 0 | `gmtime`のローカル時間版 | 5.6節
`ltrimstr` | 1 | 指定の文字列を入力の先頭から省く | 6.1節
`map` | 1 | 配列のすべての要素を引数の操作で変換した配列を返す | 7.3節
`map_values` | 1 | オブジェクトのすべての値を引数の操作で変換する | 7.3節
`match` | 1 | （正規表現）マッチした部分文字列をオブジェクトで返す | 6.2節
`max` | 0 | 配列の最大値を返す | 4.4節
`max_by` | 0 | オブジェクトの値の最大値を返す | 4.4節
`min` | 0 | 配列の最小値を返す | 4.4節
`min_by` | 0 | オブジェクトの値の最小値を返す | 4.4節
`mktime` | 0 | tm構造体配列からUnixエポック時間を生成する | 5.4節
`now` | 0 | 現在のUnixエポック時間を取得する | 5.6節
`nth` | 1 | 配列から`<n>`番目の要素を取りだす | 7.1節
`nulls` | 0 | `null`だけを抽出する | 4.2節
`numbers` | 0 | 数値だけを抽出する | 4.2節
`objects` | 0 | オブジェクトだけを抽出する | 4.2節
`path` | 1 | 分解したパスを配列で返す（パス配列） | 8.3節
`range` | 1～3 | 指定の範囲の数値を生成する | 5.5節
`reduce ... as $identifier` | 2 | 配列要素を第2引数の要領でまとめる。第1引数が初期値 | 7.3節
`reverse` | 0 | 配列を逆順に並べる | 7.2節
`rindex` | 1 | 右からスキャンし、第1引数と一致する最初の位置を返す | 6.1節、7.1節
`rtrimstr` | 1 | 指定の文字列を入力の末尾から省く | 6.1節
`scalars` | 0 | イテラブルでない値（基本型）を抽出する | 4.2節
`scan` | 1 | （正規表現）マッチした部分文字列を返す | 6.2節
`select`| 1 | 引数の述語関数が真を返す入力だけを選択的に返す | 10.1節
`setpath` | 2 | 第1引数のパス配列に第2引数の値を更新代入する | 8.3節
`sort` | 0 | 配列要素をソートする | 4.4節
`sort_by` | 0 | オブジェクトのプロパティ値をベースにソートする | 4.4節
`split` | 1 | 指定の文字列で入力文字列を分解して配列を返す | 6.1節
`splits` | 1 | （正規表現版の）`split` | 6.2節
`startswith` | 1 | （述語関数）入力先頭に引数の文字列があれば真を返す | 9.3節
`strftime` | 1 | Unixエポック時間を指定の形式で返す | 5.6節
`strings` | 0 | 文字列だけを抽出する | 4.2節
`sub` | 2～3 | （正規表現）マッチする文字を置き換える。オプションの第3引数はフラグ。 | 6.2節
`test` | 1 | （正規表現）指定のパターンがあれば`true`を返す | 6.2節
`to_entries` | 0 | プロパティの名前：値からオブジェクトを生成する | 8.2節
`todateiso8601` | 0 | Unixエポック時間をISO-8601形式の文字列に変換する | 5.6節
`tojson` | 0 | 通常のJSONテキストをエスケープされたJSONテキストに変換する| 4.2節
`tonumber` | 0 | 文字列を数値に変換する | 4.2節
`tostring` | 0 | 数値を文字列に変換する | 4.2節
`transpose` | 0 | 配列を転置する | 7.2節
`try-catch` | 該当しない | エラートラップ | 10.2節
`type` | 0 | データ型を文字列で返す | 4.2節
`unique` | 0 | 配列から重複を取り除く | 7.2節
`unique_by` | 1 | オブジェクトの配列から指定の値をもつオブジェクトを削除する | 8.1節
`until` | 2 | 第1引数の条件式が満たされるあいだループする。第2引数が更新式 | 10.5節
`utf8bytelength` | 0 | 文字列のバイト数を返す | 6.1節
`values` | 0 | `null`以外の値を抽出する | 4.2節
`while` | 2 | 第1引数の条件式が満たされるあいだループする。第2引数が更新式 | 10.5節
`with_entries` | 1 | `to_entries`と`from_entries`の組みあわせで、第1引数の方法でキーと値を変更する | 8.2節


### C.5 数学関数

jqの数学関数はCの数学ライブラリ（math.h）のラッパーです。ここはかなり省いたので、他の利用可能な関数のリストは[jqマニュアルのMath章](https://stedolan.github.io/jq/manual/v1.6/#Math)を参照してください。それら関数の概要は、たとえばWikipediaの[C mathematical functions](https://en.wikipedia.org/wiki/C_mathematical_functions)が参考になります。それぞれの関数の詳細はmanページを参照してください。

表C.5 数学関数

関数        | 引数の数 | 機能 | 参照
------------|---------|-----|---
`acos`        |0| 逆余弦関数（arch cosine; cos<sup>-1</sup>x) | 5.4節
`asin`        |0| 逆正弦関数（arch sine; sin<sup>-1</sup>x）| 5.4節
`atan`        |0| 逆正接関数（arch tangent; tan<sup>-1</sup>x） | 5.4節
`ceil`        |0| 丸め（+∞へ）| 5.2節
`copysign`    |2| 第1引数の値の符号を第2引数のものに変換する | 5.3節
`cos`         |0| 余弦関数（cosine; cosθ） | 5.4節
`exp`         |0| （底がeの）指数関数（exponential function with base e; e<sup>x</sup>）| 5.4節
`exp10`       |0| （底が10の）指数関数（exponential function with base 10; 10<sup>x</sup>）| 5.4節
`exp2`        |0| （底が2の）指数関数（exponential function with base 2; 2<sup>x</sup>）| 5.4節
`fabs`        |0| 浮動小数点数の絶対値（floating point absolute）| 5.3節
`floor`       |0| 丸め（-∞へ） | 5.2節
`fmax`        |2| ふたつの引数の大きいほうを返す | 5.4節
`fmin`        |2| ふたつの引数の小さいほうを返す | 5.4節
`fmod`        |2| （浮動小数点数版の）剰余 | 5.1節
`hypot`       |2| 直角三角形の斜辺の長さ（(x<sup>2</sup> + y<sup>2</sup>)<sup>1/2</sup>）| 5.4節
`log`         |0| （底がeの）対数関数（logarithmic function with base e; log<sub>e</sub>xまたはln x）| 5.4節
`log10`       |0| （底が10の）対数関数（logarithmic function with base 10; log<sub>10</sub>xまたはlog x）| 5.4節
`log2`        |0| （底が2の）対数関数（logarithmic function with base 2; log<sub>2</sub>x）| 5.4節
`modf`        |0| 小数点数を整数部分と小数部分に分解する。負号はどちらにもおなじものがつけられる。 | 5.3節
`pow`         |2| 任意の底のべき乗（a<sup>x</sup>）| 5.4節
`round`       |0| 丸め（最近接）| 5.2節
`sin`         |0| 正弦関数（sine; sinθ） | 5.4節
`sqrt`        |0| 平方根 | 5.4節
`tan`         |0| 正接関数（tangent; tanθ）| 5.4節
`trunc`       |0| 丸め（0へ）| 5.2節


### C.6 定数、特殊変数

本節には定数あるいは特殊変数をまとめて示します。

表C.6 定数、特殊変数

定数 | 意味 | 参照
-----|------|-------
infinite | 無限大 | 5.8節
nan | 非数（not a number）| 5.8節
$ENV | 環境変数 | 10.3節